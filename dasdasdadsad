-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local UseItem = ReplicatedStorage:WaitForChild("Packages")
    :WaitForChild("Net")
    :WaitForChild("RE/UseItem")

-- GUI
local gui = Instance.new("ScreenGui")
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local btn = Instance.new("TextButton")
btn.Size = UDim2.new(0, 150, 0, 45)
btn.Position = UDim2.new(0, 20, 0, 20)
btn.Text = "Shoot"
btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
btn.TextColor3 = Color3.new(1, 1, 1)
btn.Parent = gui

-- Find nearest player
local function getNearest()
    local char = player.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local nearest, dist
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local d = (plr.Character.HumanoidRootPart.Position - hrp.Position).Magnitude
            if not dist or d < dist then
                dist = d
                nearest = plr
            end
        end
    end
    return nearest
end

-- Equip the gun if not equipped
local function preEquip()
    local char = player.Character
    if not char then return end
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not hum then return end

    local tool = char:FindFirstChild("Paintball Gun") or player.Backpack:FindFirstChild("Paintball Gun")
    if tool then
        hum:EquipTool(tool)
    end
end

player.CharacterAdded:Connect(preEquip)

-- Shoot nearest player instantly
local function shootNearest()
    preEquip()
    local target = getNearest()
    if not target then return end
    local pos = target.Character.HumanoidRootPart.Position
    UseItem:FireServer(pos)
end

-- Spam shooting while button is held
local shooting = false

btn.MouseButton1Down:Connect(function()
    shooting = true
end)
btn.MouseButton1Up:Connect(function()
    shooting = false
end)

-- Fire every frame while holding
RunService.Heartbeat:Connect(function()
    if shooting then
        shootNearest()
    end
end)
