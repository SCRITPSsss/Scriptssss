-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local UseItem = ReplicatedStorage:WaitForChild("Packages")
    :WaitForChild("Net")
    :WaitForChild("RE/UseItem")

-- Find nearest player
local function getNearest()
    local char = player.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local nearest, dist
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local d = (plr.Character.HumanoidRootPart.Position - hrp.Position).Magnitude
            if not dist or d < dist then
                dist = d
                nearest = plr
            end
        end
    end
    return nearest
end

-- Equip gun
local function preEquip()
    local char = player.Character
    if not char then return end
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not hum then return end

    local tool = char:FindFirstChild("Paintball Gun") or player.Backpack:FindFirstChild("Paintball Gun")
    if tool then
        hum:EquipTool(tool)
    end
end

player.CharacterAdded:Connect(preEquip)

-- Shoot nearest
local function shootNearest()
    preEquip()
    local target = getNearest()
    if not target then return end
    local pos = target.Character.HumanoidRootPart.Position
    UseItem:FireServer(pos)
end

-- Hold ; to spam
local shooting = false

UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.Semicolon then
        shooting = true
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.Semicolon then
        shooting = false
    end
end)

-- Fire loop
RunService.Heartbeat:Connect(function()
    if shooting then
        shootNearest()
    end
end)
